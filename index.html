<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rummikub Turn Timer</title>

<style>
body {
  margin: 0;
  background: #0b0f14;
  color: #e8eef6;
  font-family: system-ui, -apple-system, sans-serif;
}

.hidden { display: none; }

.wrap {
  max-width: 720px;
  margin: 0 auto;
  padding: 16px;
}

/* ===== 設定 ===== */
.card {
  background:#121a24;
  border:1px solid #1f2a3a;
  border-radius:16px;
  padding:16px;
}
.row {
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}
input, select {
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #263244;
  background:#0e1520;
  color:#e8eef6;
}
button {
  padding:14px;
  border-radius:14px;
  border:none;
  font-size:16px;
  font-weight:700;
}
.primary { background:#2a63ff; color:#fff; }
.danger { background:#ff3b3b; color:#fff; }

/* ===== プレイ ===== */
#play {
  position: fixed;
  inset: 0;
  background:#0b0f14;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;

  /* 重要：初期状態では操作不可 */
  pointer-events: none;
}

#play.active {
  pointer-events: auto;
}

#centerTap {
  width: 100%;
  height: 100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}

#time {
  font-size: 120px;
  font-weight: 900;
}

#who {
  margin-top: 12px;
  font-size: 32px;
  color:#aab6c6;
}

.warning {
  color:#ff5a5a;
  animation:pulse .8s infinite;
}
@keyframes pulse {
  0%{transform:scale(1)}
  50%{transform:scale(1.05)}
  100%{transform:scale(1)}
}
</style>
</head>

<body>

<!-- 設定画面 -->
<div id="settings" class="wrap">
  <h2>設定</h2>
  <div class="card">
    <div class="row">
      <select id="count">
        <option>2</option>
        <option selected>3</option>
        <option>4</option>
        <option>5</option>
      </select>
      <input id="limit" type="number" value="60">
    </div>
    <div class="row" style="margin-top:12px;">
      <input class="pname" value="P1">
      <input class="pname" value="P2">
      <input class="pname" value="P3">
      <input class="pname" value="P4">
      <input class="pname" value="P5">
    </div>
    <div class="row" style="margin-top:12px;">
      <button id="start" class="primary">開始</button>
      <button id="reset" class="danger">リセット</button>
    </div>
  </div>
</div>

<!-- プレイ画面 -->
<div id="play">
  <div id="centerTap">
    <div id="time"></div>
    <div id="who"></div>
    <div style="opacity:.6;margin-top:10px;">タップ：次へ / 5秒長押し：設定</div>
  </div>
</div>

<script>
(() => {
  const $ = id => document.getElementById(id);

  const settings = $("settings");
  const play = $("play");
  const timeEl = $("time");
  const whoEl = $("who");

  let players = [];
  let limit = 60;
  let idx = 0;
  let remain = 0;
  let timer = null;

  function showSettings(){
    settings.classList.remove("hidden");
    play.classList.remove("active");
    play.classList.add("hidden");
    clearInterval(timer);
  }

  function showPlay(){
    settings.classList.add("hidden");
    play.classList.remove("hidden");
    play.classList.add("active");
    startTurn();
  }

  function startTurn(){
    remain = limit;
    update();
    clearInterval(timer);
    timer = setInterval(tick,1000);
  }

  function tick(){
    remain--;
    if(remain <= 10) timeEl.classList.add("warning");
    if(remain <= 0){
      remain = 0;
      clearInterval(timer);
    }
    update();
  }

  function update(){
    timeEl.textContent =
      Math.floor(remain/60)+":"+String(remain%60).padStart(2,"0");
    whoEl.textContent = players[idx] + " の番";
  }

  function next(){
    idx = (idx+1)%players.length;
    timeEl.classList.remove("warning");
    startTurn();
  }

  let holdTimer;
  $("centerTap").addEventListener("pointerdown",()=>{
    holdTimer = setTimeout(showSettings,5000);
  });
  ["pointerup","pointerleave"].forEach(e=>{
    $("centerTap").addEventListener(e,()=>clearTimeout(holdTimer));
  });
  $("centerTap").addEventListener("click",next);

  $("start").onclick = ()=>{
    const names=[...document.querySelectorAll(".pname")];
    players = names
      .slice(0,Number($("count").value))
      .map((n,i)=>n.value||"P"+(i+1));
    limit = Number($("limit").value)||60;
    idx = 0;
    showPlay();
  };

  $("reset").onclick = showSettings;

  showSettings();
})();
</script>

</body>
</html>
