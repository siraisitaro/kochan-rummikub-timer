<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rummikub Turn Timer</title>

<style>
:root {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
}
body {
  margin: 0;
  background: #0b0f14;
  color: #e8eef6;
}

.hidden { display: none; }

.wrap {
  max-width: 720px;
  margin: 0 auto;
  padding: 16px;
}

/* =====================
   設定モード
===================== */
.card {
  background:#121a24;
  border:1px solid #1f2a3a;
  border-radius:16px;
  padding:16px;
}
.row {
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}
label {
  font-size:12px;
  color:#aab6c6;
  margin-bottom:6px;
  display:block;
}
input, select {
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid #263244;
  background:#0e1520;
  color:#e8eef6;
}
.col { flex:1 1 160px; }
button {
  padding:14px;
  border-radius:14px;
  border:1px solid #2a3950;
  background:#162234;
  color:#e8eef6;
  font-size:16px;
  font-weight:700;
}
button.primary {
  background:#2a63ff;
  border-color:#2a63ff;
}
button.danger {
  background:#ff3b3b;
  border-color:#ff3b3b;
}

/* =====================
   プレイモード
===================== */
#play {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
}

#centerTap {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  touch-action: manipulation;
}

#time {
  font-size: 110px;
  font-weight: 900;
  line-height: 1;
}

#who {
  margin-top: 12px;
  font-size: 32px;
  color: #aab6c6;
}

#hint {
  margin-top: 18px;
  font-size: 14px;
  color: #8fa2bd;
}

/* 10秒以下の煽り */
.warning {
  color: #ff5a5a;
  animation: pulse .8s infinite;
}
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* 長押し表示 */
#hold {
  margin-top: 20px;
  font-size: 13px;
  opacity: .7;
}
</style>
</head>

<body>

<!-- =====================
     設定モード
===================== -->
<div id="settings" class="wrap">
  <h2>設定</h2>

  <div class="card">
    <div class="row">
      <div class="col">
        <label>参加人数</label>
        <select id="count">
          <option>2</option>
          <option selected>3</option>
          <option>4</option>
          <option>5</option>
        </select>
      </div>
      <div class="col">
        <label>制限時間（秒）</label>
        <input id="limit" type="number" value="60" min="5" step="5">
      </div>
    </div>

    <div class="row" style="margin-top:12px;">
      <div class="col"><input class="pname" value="P1"></div>
      <div class="col"><input class="pname" value="P2"></div>
      <div class="col"><input class="pname" value="P3"></div>
      <div class="col"><input class="pname" value="P4"></div>
      <div class="col"><input class="pname" value="P5"></div>
    </div>

    <div class="row" style="margin-top:12px;">
      <button id="start" class="primary">開始</button>
      <button id="reset" class="danger">リセット</button>
    </div>
  </div>
</div>

<!-- =====================
     プレイモード
===================== -->
<div id="play" class="hidden">
  <div id="centerTap">
    <div id="time">1:00</div>
    <div id="who">P1の番</div>
    <div id="hint">タップ：次へ</div>
    <div id="hold">5秒長押しで設定へ</div>
  </div>
</div>

<script>
(() => {
  const $ = id => document.getElementById(id);

  const settings = $("settings");
  const play = $("play");

  const timeEl = $("time");
  const whoEl = $("who");

  const countEl = $("count");
  const limitEl = $("limit");
  const names = [...document.querySelectorAll(".pname")];

  let players = [];
  let limit = 60;
  let idx = 0;
  let remain = 0;
  let timer = null;
  let mode = "settings";

  /* ===== モード切替 ===== */
  function showSettings() {
    mode = "settings";
    settings.classList.remove("hidden");
    play.classList.add("hidden");
    stop();
  }

  function showPlay() {
    mode = "play";
    settings.classList.add("hidden");
    play.classList.remove("hidden");
    startTurn();
  }

  /* ===== タイマー ===== */
  function startTurn() {
    remain = limit;
    update();
    stop();
    timer = setInterval(tick, 1000);
  }

  function stop() {
    if (timer) clearInterval(timer);
    timer = null;
  }

  function tick() {
    remain--;
    if (remain <= 10) timeEl.classList.add("warning");
    if (remain <= 0) {
      stop();
      remain = 0;
    }
    update();
  }

  function update() {
    timeEl.textContent = Math.floor(remain/60) + ":" + String(remain%60).padStart(2,"0");
    whoEl.textContent = players[idx] + " の番";
  }

  function next() {
    idx = (idx + 1) % players.length;
    startTurn();
  }

  /* ===== 長押し（5秒） ===== */
  let holdTimer = null;
  const HOLD_TIME = 5000;

  $("centerTap").addEventListener("pointerdown", () => {
    holdTimer = setTimeout(showSettings, HOLD_TIME);
  });

  ["pointerup","pointerleave","pointercancel"].forEach(ev =>
    $("centerTap").addEventListener(ev, () => clearTimeout(holdTimer))
  );

  $("centerTap").addEventListener("click", () => {
    if (mode === "play") next();
  });

  /* ===== 設定 ===== */
  $("start").onclick = () => {
    players = names.slice(0, +countEl.value).map((n,i)=>n.value||"P"+(i+1));
    limit = +limitEl.value || 60;
    idx = 0;
    showPlay();
  };

  $("reset").onclick = () => {
    idx = 0;
    showSettings();
  };
})();
</script>

</body>
</html>
